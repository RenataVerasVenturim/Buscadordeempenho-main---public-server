const{google:e}=require("googleapis"),fs=require("fs"),express=require("express"),server=express(),port=process.env.PORT||3e3;async function authenticateGoogleSheets(){try{let o=new e.auth.GoogleAuth({credentials:{client_email:process.env.CLIENT_EMAIL,private_key:process.env.PRIVATE_KEY.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets"]}),a=e.sheets({version:"v4",auth:o}),r=await a.spreadsheets.values.get({spreadsheetId:process.env.SPREADSHEET_ID,range:"Planilha de Controle"});return console.log("Autentica\xe7\xe3o com o Google Sheets bem-sucedida."),r.data}catch(t){throw console.error("Erro na autentica\xe7\xe3o com o Google Sheets:",t),t}}server.use(express.static("public",{maxAge:36e5})),server.get("/empenhos",async(e,a)=>{try{let o=e.query.numeroEmpenho,r=o.trim().toUpperCase(),t=await authenticateGoogleSheets();console.log("Dados da planilha carregados.");let n=t.values,s=n.filter(e=>{let a=e[1].trim().toUpperCase();return a===r});if(s.length>0){let p=["N\xfamero do processo","N\xfamero do empenho","Ano do empenho","N\xba Nota fiscal","Respons\xe1vel pela liquida\xe7\xe3o","Comprovante de liquida\xe7\xe3o realizada","Status do empenho","Bloco de assinatura","Solicita\xe7\xe3o de recurso (para casos de arrecada\xe7\xe3o pr\xf3pria)","Comprovante de pagamento (ordem banc\xe1ria)","Data de pagamento realizado","Observa\xe7\xf5es"],m=[0,1,3,5,6,9,10,11],d=s.map(e=>{let a=m.map(a=>p[a]+": "+e[a]).join("<br>");return a}).join("<br><br>"),l=fs.readFileSync("public/template.html","utf8"),i=l.replace("{{empenhoData}}",d);a.send(i)}else a.status(404).send(`Nenhum empenho ${o} encontrado.`)}catch(c){console.error("Erro ao buscar informa\xe7\xf5es do empenho:",c),a.status(500).send("Erro ao buscar informa\xe7\xf5es do empenho. Por favor, tente novamente mais tarde.")}});
